<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.douzone.dataservice.mapper.ResultMapper">
    <select id="selectAll" resultType="com.douzone.dataservice.domain.ResultDTO">
        SELECT DISTINCT V.PATIENT_NO, PT.PATIENT_NAME, PT.PATIENT_PHONENUMBER, CN.RESULT_NO, R.REGISTER_DT, S.SAMPLE_NAME, P.PRESCRIBE_DT, I.INSPECTION_NAME ,I.INSPECTION_NAME, CN.FIGURES, I.UNIT, I.BASELINE, CN.NOTE
        FROM PATIENT AS PT, VISIT AS V, PRESCRIBE AS P, ORDER_SLIP AS O, COLLECTING AS CG, CONCLUSION AS CN, INSPECTION_TYPE AS I, VESSEL AS VL, CLASSIFICATION AS C, REGISTER AS R, SAMPLE_TYPE AS S
        WHERE PT.PATIENT_NO = 1
        AND PT.PATIENT_NO = V.PATIENT_NO
        AND V.VISIT_CODE = P.VISIT_CODE
        AND P.ORDER_CODE = O.ORDER_CODE
        AND O.VESSEL_CODE = VL.VESSEL_CODE
        AND P.PRESCRIBE_CODE = CG.PRESCRIBE_CODE
        AND O.CLASSIFICATION_CODE = C.CLASSIFICATION_CODE
        AND CG.BARCODE = R.BARCODE
        AND R.REGISTER_CODE = CN.REGISTER_CODE
        AND I.INSPECTION_CODE = CN.INSPECTION_CODE
        AND VL.SAMPLE_CODE = S.SAMPLE_CODE
        AND O.ORDER_CODE = I.ORDER_CODE
        ORDER BY R.REGISTER_DT DESC;
    </select>

    <select id="getSearchResultMapper" resultType="com.douzone.dataservice.domain.ResultDTO" parameterType="com.douzone.dataservice.domain.ResultSearchDTO">
        SELECT DISTINCT V.PATIENT_NO, PT.PATIENT_NAME, PT.PATIENT_PHONENUMBER, CN.RESULT_NO, R.REGISTER_DT, S.SAMPLE_NAME, P.PRESCRIBE_DT, I.INSPECTION_NAME ,I.INSPECTION_NAME, CN.FIGURES, I.UNIT, I.BASELINE, CN.NOTE
        FROM PATIENT AS PT, VISIT AS V, PRESCRIBE AS P, ORDER_SLIP AS O, COLLECTING AS CG, CONCLUSION AS CN, INSPECTION_TYPE AS I, VESSEL AS VL, CLASSIFICATION AS C, REGISTER AS R, SAMPLE_TYPE AS S
        <if test='patientNo != null and radioDate == "registerDate"'>
            where left(register_dt, 10) between #{startDate} and #{endDate}
        </if>
        <if test='patientNo != null and radioDate == "prescribeDate"'>
            where prescribe_dt between #{startDate} and #{endDate}
        </if>
        AND V.PATIENT_NO=#{patientNo}
        AND PT.PATIENT_NO = V.PATIENT_NO
        AND V.VISIT_CODE = P.VISIT_CODE
        AND P.ORDER_CODE = O.ORDER_CODE
        AND O.VESSEL_CODE = VL.VESSEL_CODE
        AND P.PRESCRIBE_CODE = CG.PRESCRIBE_CODE
        AND O.CLASSIFICATION_CODE = C.CLASSIFICATION_CODE
        AND CG.BARCODE = R.BARCODE
        AND R.REGISTER_CODE = CN.REGISTER_CODE
        AND I.INSPECTION_CODE = CN.INSPECTION_CODE
        AND VL.SAMPLE_CODE = S.SAMPLE_CODE
        AND O.ORDER_CODE = I.ORDER_CODE
        ORDER BY R.register_dt DESC

    </select>

    <select id="searchNotDate" resultType="com.douzone.dataservice.domain.ResultDTO" parameterType="int">
        SELECT DISTINCT V.PATIENT_NO, PT.PATIENT_NAME, PT.PATIENT_PHONENUMBER, CN.RESULT_NO, R.REGISTER_DT, S.SAMPLE_NAME, P.PRESCRIBE_DT, I.INSPECTION_NAME ,I.INSPECTION_NAME, CN.FIGURES, I.UNIT, I.BASELINE, CN.NOTE
        FROM PATIENT AS PT, VISIT AS V, PRESCRIBE AS P, ORDER_SLIP AS O, COLLECTING AS CG, CONCLUSION AS CN, INSPECTION_TYPE AS I, VESSEL AS VL, CLASSIFICATION AS C, REGISTER AS R, SAMPLE_TYPE AS S
        WHERE V.PATIENT_NO = #{text}
        AND PT.PATIENT_NO = V.PATIENT_NO
        AND V.VISIT_CODE = P.VISIT_CODE
        AND P.ORDER_CODE = O.ORDER_CODE
        AND O.VESSEL_CODE = VL.VESSEL_CODE
        AND P.PRESCRIBE_CODE = CG.PRESCRIBE_CODE
        AND O.CLASSIFICATION_CODE = C.CLASSIFICATION_CODE
        AND CG.BARCODE = R.BARCODE
        AND R.REGISTER_CODE = CN.REGISTER_CODE
        AND I.INSPECTION_CODE = CN.INSPECTION_CODE
        AND VL.SAMPLE_CODE = S.SAMPLE_CODE
        AND O.ORDER_CODE = I.ORDER_CODE
        ORDER BY R.REGISTER_DT DESC;
    </select>
</mapper>

